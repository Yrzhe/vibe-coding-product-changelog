version: '3.8'

services:
  # Web 前端服务
  web:
    build: ./webapp
    image: product-changelog-viewer:latest
    container_name: changelog-viewer
    ports:
      - "8080:80"
    volumes:
      - ./storage:/usr/share/nginx/html/data/storage:ro
      - ./info:/usr/share/nginx/html/data/info:ro
    restart: unless-stopped

  # 爬虫/监控服务（用于手动触发或定时任务）
  crawler:
    build: ./script
    image: changelog-crawler:latest
    container_name: changelog-crawler
    volumes:
      - ./storage:/app/storage
      - ./info:/app/info
      - ./logs:/app/logs
    # 默认不自动启动，需要手动运行或通过 cron 触发
    profiles:
      - crawler
    environment:
      - TZ=Asia/Shanghai
